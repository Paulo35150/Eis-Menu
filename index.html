<!DOCTYPE html>
<html lang="de" translate="no">
<head>
    <meta charset="UTF-8">
    <title>Food & Drinks ‚Äì QR Tischbestellung</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google" content="notranslate">

    <style>
        :root {
            --primary: #e53935;
            --primary-dark: #b71c1c;
            --bg: #fff8f2;
            --card-bg: #ffffff;

            --tab-portions: #ffb300;
            --tab-kids: #ff4081;
            --tab-eis: #29b6f6;
            --tab-food: #66bb6a;
            --tab-drinks: #ab47bc;
        }
        * { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: radial-gradient(circle at top, #fffdf8 0%, #fff3e0 35%, #ffe0b2 100%);
            margin: 0;
            padding: 0;
            color: #222;
        }

        /* HEADER */
        .header {
            width: 100%;
            background: linear-gradient(135deg, #000000 0%, #111111 40%, #000000 100%);
            padding: 12px 0 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 2px 8px rgba(0,0,0,0.35);
        }
        .header-inner {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 0 10px;
        }
        .header-logo {
            max-width: 100%;
            max-height: 80px;
            height: auto;
            width: auto;
            object-fit: contain;
        }
        .header-title {
            font-size: 20px;
            font-weight: 600;
            color: #fdd835;
            letter-spacing: 0.5px;
            text-align: center;
        }
        @media (max-width: 600px) {
            .header-inner {
                flex-direction: column;
                gap: 6px;
            }
            .header-title {
                font-size: 17px;
            }
        }

        .container {
            padding: 15px;
            max-width: 960px;
            margin: 0 auto 25px auto;
        }
        .section-title {
            font-size: 18px;
            margin-top: 18px;
            margin-bottom: 8px;
            border-left: 4px solid var(--primary);
            padding-left: 8px;
        }
        .card {
            background: var(--card-bg);
            padding: 14px;
            border-radius: 14px;
            margin-bottom: 14px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.06);
            border: 1px solid rgba(255,255,255,0.8);
        }
        label {
            font-size: 14px;
            display: block;
            margin-top: 5px;
            margin-bottom: 3px;
        }
        select, input {
            width: 100%;
            padding: 9px 10px;
            font-size: 14px;
            border-radius: 10px;
            border: 1px solid #d0d0d0;
            background: #fff;
        }
        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(229,57,53,0.2);
        }
        .btn {
            background: var(--primary);
            color: #fff;
            padding: 10px;
            display: inline-block;
            text-align: center;
            border-radius: 999px;
            text-decoration: none;
            margin-top: 12px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
        }
        .btn:hover {
            background: var(--primary-dark);
            box-shadow: 0 4px 10px rgba(0,0,0,0.18);
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 4px rgba(0,0,0,0.15);
        }
        .btn:disabled {
            background: #c5c5c5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        #warenkorb {
            background: rgba(255,255,255,0.98);
            padding: 14px;
            border-radius: 16px;
            margin-top: 20px;
            box-shadow: 0 8px 18px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.9);
        }
        #liste-items div {
            padding: 6px 0;
            border-bottom: 1px dashed #e0e0e0;
            font-size: 14px;
        }
        .line-item {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            align-items: center;
        }
        .item-info {
            flex: 1;
        }
        .btn-remove {
            background: #ff7043;
            border: none;
            color: #fff;
            padding: 4px 9px;
            border-radius: 999px;
            font-size: 11px;
            cursor: pointer;
        }
        .btn-remove:hover {
            background: #f4511e;
        }
        .total {
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
            text-align: right;
        }
        .small {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }

        /* TABS */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }
        .tab-btn {
            flex: 1 1 auto;
            padding: 7px 8px;
            font-size: 13px;
            border-radius: 999px;
            border: 1px solid #ddd;
            background: #ffffff;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #444;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .tab-btn.active {
            color: #fff;
            border-color: transparent;
            box-shadow: 0 3px 9px rgba(0,0,0,0.15);
        }
        .tab-portions.active { background: var(--tab-portions); }
        .tab-kids.active     { background: var(--tab-kids); }
        .tab-eis.active      { background: var(--tab-eis); }
        .tab-food.active     { background: var(--tab-food); }
        .tab-drinks.active   { background: var(--tab-drinks); }

        .tab-portions { border-color: rgba(255,179,0,0.6); }
        .tab-kids     { border-color: rgba(255,64,129,0.5); }
        .tab-eis      { border-color: rgba(41,182,246,0.5); }
        .tab-food     { border-color: rgba(102,187,106,0.6); }
        .tab-drinks   { border-color: rgba(171,71,188,0.6); }

        @media (max-width: 600px) {
            .tab-btn {
                font-size: 11px;
                padding: 6px 6px;
            }
        }

        /* Chef-Bereich */
        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .btn-logout {
            background: #757575;
            border: none;
            color: #fff;
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
        }
        .btn-logout:hover {
            background: #616161;
        }
        .admin-order {
            border-bottom: 1px dashed #ddd;
            padding: 6px 0;
            font-size: 12px;
        }
        .btn-small {
            background: #c62828;
            border: none;
            color: #fff;
            padding: 3px 7px;
            border-radius: 999px;
            font-size: 11px;
            cursor: pointer;
            margin-top: 3px;
        }
        .btn-small:hover {
            background: #b71c1c;
        }

        /* Rechtlicher Hinweis */
        .legal-box {
            font-size: 11px;
            color: #777;
            margin: 10px auto 0 auto;
            max-width: 960px;
            text-align: left;
            line-height: 1.5;
            padding: 0 12px 18px 12px;
        }
        .legal-box details {
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 8px 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .legal-box summary {
            cursor: pointer;
        }

        /* BARRA DE IDIOMAS */
        .lang-bar {
            max-width: 960px;
            margin: 8px auto 0 auto;
            padding: 6px 10px;
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
        }
        .lang-label {
            font-size: 13px;
            color: #333;
            margin-right: 4px;
        }
        .lang-btn {
            border-radius: 999px;
            border: 1px solid #ccc;
            background: #fff;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .lang-btn.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary-dark);
        }
    </style>
</head>

<body>

<header class="header">
    <div class="header-inner">
        <img src="sanremo-digital-systems-horizontal.png"
             alt="Sanremo Digital Systems Logo"
             class="header-logo">
        <div class="header-title" id="txt_header_title">
            Digitaler QR-Tischservice ‚Äì Internes Bestellsystem
        </div>
    </div>
</header>

<!-- Barra de idiomas -->
<div class="lang-bar">
    <span class="lang-label" id="txt_lang_label">Sprache:</span>
    <button class="lang-btn active" data-lang="de">üá©üá™ DE</button>
    <button class="lang-btn" data-lang="it">üáÆüáπ IT</button>
    <button class="lang-btn" data-lang="pt">üáµüáπ PT</button>
    <button class="lang-btn" data-lang="es">üá™üá∏ ES</button>
    <button class="lang-btn" data-lang="fr">üá´üá∑ FR</button>
    <button class="lang-btn" data-lang="nl">üá≥üá± NL</button>
</div>

<div class="container">

    <!-- TISCHWAHL -->
    <div class="card">
        <h2 class="section-title" id="txt_section_table">Tisch w√§hlen</h2>
        <label for="tisch" id="txt_label_tisch">Tischnummer ausw√§hlen:</label>
        <select id="tisch">
            <option value="" id="txt_option_tisch">Tisch ausw√§hlen‚Ä¶</option>
        </select>
        <div class="small" id="txt_small_tisch_range">Verf√ºgbar: Tisch 1 bis 33</div>
    </div>

    <!-- PRODUKTWAHL -->
    <div class="card">
        <h2 class="section-title" id="txt_section_product">Produkt w√§hlen</h2>

        <div class="tabs">
            <button class="tab-btn tab-portions active" data-group="portions" id="txt_tab_portions">Portionen</button>
            <button class="tab-btn tab-kids" data-group="kids" id="txt_tab_kids">Kinder</button>
            <button class="tab-btn tab-eis" data-group="eis" id="txt_tab_eis">Eisbecher &amp; Spaghetti</button>
            <button class="tab-btn tab-food" data-group="food" id="txt_tab_food">Snacks &amp; Waffeln</button>
            <button class="tab-btn tab-drinks" data-group="drinks" id="txt_tab_drinks">Getr√§nke</button>
        </div>

        <label for="produkt" id="txt_label_product">Produkt:</label>
        <select id="produkt"></select>

        <!-- Sortenwahl nur f√ºr Portionen (optional) -->
        <div id="geschmack-box" style="margin-top:12px; display:none;">
            <label id="txt_label_flavors">Sorten (optional, bis zu 3 w√§hlen):</label>
            <select id="geschmack1"></select>
            <select id="geschmack2" style="margin-top:6px;"></select>
            <select id="geschmack3" style="margin-top:6px;"></select>
            <div class="small" id="txt_small_flavors">
                Wenn keine Sorten gew√§hlt werden, kommt die Portion in unserer Standardmischung.
            </div>
        </div>

        <!-- Sahne-Option -->
        <div id="sahne-box" style="margin-top:8px; display:none;">
            <label for="sahne" id="txt_label_sahne">Sahne (+1,20 ‚Ç¨):</label>
            <select id="sahne">
                <option value=""><?php /* texto ser√° atualizado por JS se precisares */ ?></option>
                <option value="mit Sahne">mit Sahne (+1,20 ‚Ç¨)</option>
                <option value="ohne Sahne">ohne Sahne</option>
            </select>
            <div class="small" id="txt_small_sahne">
                Wenn nichts gew√§hlt wird, bereiten wir es wie auf der Karte zu.
            </div>
        </div>

        <label for="bemerkung" style="margin-top:8px;" id="txt_label_bemerkung">Bemerkung (optional):</label>
        <input id="bemerkung" type="text" placeholder="z.B. ohne Sahne, wenig So√üe ‚Ä¶">

        <button class="btn" id="btn_add_to_cart" onclick="addToCart()">Zum Warenkorb hinzuf√ºgen</button>
    </div>

    <!-- WARENKORB -->
    <div id="warenkorb">
        <h2 class="section-title" id="txt_section_cart">üß∫ Warenkorb</h2>
        <div id="liste-items"></div>
        <div class="total" id="gesamt">Gesamt: 0,00 ‚Ç¨</div>

        <button id="btn-whatsapp" class="btn" onclick="sendWhatsApp()" disabled>
            <span id="txt_btn_whatsapp">Bestellung per WhatsApp senden üì≤</span>
        </button>

        <button id="btn-print" class="btn" style="margin-top:8px; background:#007b83;" onclick="printOrder()" disabled>
            <span id="txt_btn_print">Bestellung drucken üñ®Ô∏è</span>
        </button>

        <button class="btn" id="btn-reset" style="margin-top:8px; background:#555;" onclick="resetTable()">
            <span id="txt_btn_reset_table">Tisch l√∂schen / neue G√§ste</span>
        </button>

        <div class="small" style="margin-top:6px;" id="gps-info">
            GPS wird gepr√ºft‚Ä¶ bitte Standort-Freigabe erlauben.
        </div>
    </div>

    <!-- CHEF LOGIN -->
    <div class="card" id="admin-login-card">
        <h2 class="section-title" id="txt_section_admin">Chef-Bereich</h2>
        <p class="small" id="txt_admin_intro">
            Zugang nur f√ºr Inhaber / Gesch√§ftsf√ºhrer. Hier werden alle gesendeten Bestellungen gespeichert
            und Produkte / Preise angepasst.
        </p>
        <label for="admin-password" id="txt_admin_password_label">Chef-Passwort:</label>
        <input id="admin-password" type="password" placeholder="Passwort eingeben">
        <button class="btn" id="txt_admin_login_btn" onclick="adminLogin()">Chef-Login</button>
    </div>

    <!-- CHEF PANEL -->
    <div class="card" id="admin-panel" style="display:none;">
        <div class="admin-header">
            <h2 class="section-title" style="margin-bottom:0;" id="txt_admin_saved_orders">Gespeicherte Bestellungen</h2>
            <button class="btn-logout" id="txt_admin_logout_btn" onclick="adminLogout()">Logout</button>
        </div>
        <div class="small" style="margin-top:4px;" id="txt_admin_saved_info">
            Hier werden alle Bestellungen gespeichert, die per WhatsApp gesendet oder gedruckt wurden.
            Der Chef kann einzelne Bestellungen oder alle Eintr√§ge l√∂schen.
        </div>
        <div id="admin-orders-list" style="margin-top:10px;"></div>
        <button class="btn" style="margin-top:10px; background:#c62828;" id="txt_admin_delete_all" onclick="clearAllOrders()">
            Alle Bestellungen l√∂schen
        </button>

        <hr style="margin:18px 0; border:none; border-top:1px solid #eee;">

        <!-- PRODUKT-VERWALTUNG -->
        <h3 class="section-title" style="border-left-color:#00796b;" id="txt_admin_product_edit">Produkte bearbeiten</h3>
        <label for="admin-product-select" id="txt_admin_product_select">Bestehendes Produkt w√§hlen:</label>
        <select id="admin-product-select"></select>
        <div class="small" id="txt_admin_local_info">
            √Ñnderungen werden lokal im Browser gespeichert (pro Ger√§t / Standort).
        </div>

        <label for="admin-prod-name" id="txt_admin_prod_name_label">Name:</label>
        <input id="admin-prod-name" type="text">

        <label for="admin-prod-price" id="txt_admin_prod_price_label">Preis (‚Ç¨):</label>
        <input id="admin-prod-price" type="number" step="0.01">

        <label for="admin-prod-group" id="txt_admin_prod_group_label">Gruppe:</label>
        <select id="admin-prod-group">
            <option value="portions">Portionen</option>
            <option value="kids">Kinder</option>
            <option value="eis">Eisbecher &amp; Spaghetti</option>
            <option value="food">Snacks &amp; Waffeln</option>
            <option value="drinks">Getr√§nke</option>
        </select>

        <label for="admin-prod-type" id="txt_admin_prod_type_label">Art:</label>
        <select id="admin-prod-type">
            <option value="normal">Normal</option>
            <option value="cup3">Portion (Sortenwahl)</option>
        </select>

        <label style="margin-top:6px;" id="txt_admin_sahne_label">
            <input type="checkbox" id="admin-prod-sahne"> Sahne-Option (+1,20 ‚Ç¨) erlauben
        </label>

        <button class="btn" style="margin-top:10px;" id="txt_admin_save_btn" onclick="saveExistingProduct()">
            Ausgew√§hltes Produkt speichern
        </button>
        <button class="btn" style="margin-top:6px; background:#c62828;" id="txt_admin_delete_btn" onclick="deleteExistingProduct()">
            Ausgew√§hltes Produkt l√∂schen
        </button>

        <h3 class="section-title" style="border-left-color:#0288d1; margin-top:20px;" id="txt_admin_add_new">Neues Produkt hinzuf√ºgen</h3>
        <label for="new-prod-id" id="txt_admin_new_id_label">Produkt-Nr. (z.B. 701):</label>
        <input id="new-prod-id" type="number">

        <label for="new-prod-name" id="txt_admin_new_name_label">Name:</label>
        <input id="new-prod-name" type="text">

        <label for="new-prod-price" id="txt_admin_new_price_label">Preis (‚Ç¨):</label>
        <input id="new-prod-price" type="number" step="0.01">

        <label for="new-prod-group" id="txt_admin_new_group_label">Gruppe:</label>
        <select id="new-prod-group">
            <option value="portions">Portionen</option>
            <option value="kids">Kinder</option>
            <option value="eis">Eisbecher &amp; Spaghetti</option>
            <option value="food">Snacks &amp; Waffeln</option>
            <option value="drinks">Getr√§nke</option>
        </select>

        <label for="new-prod-type" id="txt_admin_new_type_label">Art:</label>
        <select id="new-prod-type">
            <option value="normal">Normal</option>
            <option value="cup3">Portion (Sortenwahl)</option>
        </select>

        <label style="margin-top:6px;" id="txt_admin_new_sahne_label">
            <input type="checkbox" id="new-prod-sahne"> Sahne-Option (+1,20 ‚Ç¨) erlauben
        </label>

        <button class="btn" style="margin-top:10px;" id="txt_admin_new_btn" onclick="addNewProduct()">
            Neues Produkt anlegen
        </button>

        <!-- SORTEN-VERWALTUNG -->
        <h3 class="section-title" style="border-left-color:#6a1b9a; margin-top:20px;" id="txt_sorten_title">Eissorten verwalten</h3>
        <div id="sorten-list" class="small" style="margin-bottom:8px;"></div>

        <label for="new-sorte" id="txt_new_sorte_label">Neue Sorte:</label>
        <input id="new-sorte" type="text" placeholder="z.B. Stracciatella Light">

        <button class="btn" style="margin-top:6px;" id="txt_new_sorte_btn" onclick="addNewSorte()">
            Sorte hinzuf√ºgen
        </button>

        <!-- RECHTLICHER HINWEIS NUR F√úR CHEF -->
        <div class="legal-box">
            <details>
                <summary id="txt_legal_summary"><strong>Rechtlicher Hinweis (anklicken)</strong></summary>
                <p id="txt_legal_p1">
                    Dieses Bestellsystem ist ein internes, nicht fiskalisiertes Software-Tool und ersetzt keine
                    Registrierkasse oder steuerrechtlich relevante Aufzeichnung.
                </p>
                <p id="txt_legal_p2">
                    Der Betreiber dieses Systems ist allein verantwortlich f√ºr die ordnungsgem√§√üe Nutzung und Einhaltung
                    aller gesetzlichen Vorschriften.
                </p>
                <p id="txt_legal_p3">
                    Dieses System besitzt keine Verbindung zu einer elektronischen Kasse, erf√ºllt nicht die Anforderungen der
                    Kassensicherungsverordnung (KassenSichV), der Technischen Sicherheitseinrichtung (TSE) oder der DSFinV-K
                    und darf nicht als Kassensystem verwendet werden.
                </p>
            </details>
        </div>
    </div>

</div> <!-- container -->

<!-- 1¬∫ SCRIPT: O TEU ORIGINAL (N√ÉO MEXI) -->
<script>
/* TODO O TEU SCRIPT ORIGINAL VAI AQUI
   (BASE_PRODUCTS, SORTEN, PRODUCTS, addToCart, buildOrderText, sendWhatsApp, printOrder, GPS, admin, etc.)
   Podes simplesmente copiar o <script> que me mandaste e colar aqui dentro.
*/
</script>

<!-- 2¬∫ SCRIPT: IDIOMAS + SAVE_ORDER.PHP + OVERRIDE WHATSAPP / PRINT -->
<script>
let currentLang = "de";

const translations = {
  de: {
    header_title: "Digitaler QR-Tischservice ‚Äì Internes Bestellsystem",
    lang_label: "Sprache:",
    section_table: "Tisch w√§hlen",
    label_tisch: "Tischnummer ausw√§hlen:",
    option_tisch: "Tisch ausw√§hlen‚Ä¶",
    small_tisch_range: "Verf√ºgbar: Tisch 1 bis 33",
    section_product: "Produkt w√§hlen",
    tab_portions: "Portionen",
    tab_kids: "Kinder",
    tab_eis: "Eisbecher & Spaghetti",
    tab_food: "Snacks & Waffeln",
    tab_drinks: "Getr√§nke",
    label_product: "Produkt:",
    label_flavors: "Sorten (optional, bis zu 3 w√§hlen):",
    small_flavors: "Wenn keine Sorten gew√§hlt werden, kommt die Portion in unserer Standardmischung.",
    label_sahne: "Sahne (+1,20 ‚Ç¨):",
    small_sahne: "Wenn nichts gew√§hlt wird, bereiten wir es wie auf der Karte zu.",
    label_bemerkung: "Bemerkung (optional):",
    placeholder_bemerkung: "z.B. ohne Sahne, wenig So√üe ‚Ä¶",
    section_cart: "üß∫ Warenkorb",
    btn_add_cart: "Zum Warenkorb hinzuf√ºgen",
    btn_whatsapp: "Bestellung per WhatsApp senden üì≤",
    btn_print: "Bestellung drucken üñ®Ô∏è",
    btn_reset_table: "Tisch l√∂schen / neue G√§ste",
    gps_info: "GPS wird gepr√ºft‚Ä¶ bitte Standort-Freigabe erlauben."
  },
  it: {
    header_title: "Servizio QR da tavolo ‚Äì Sistema interno",
    lang_label: "Lingua:",
    section_table: "Scegli il tavolo",
    label_tisch: "Seleziona numero del tavolo:",
    option_tisch: "Seleziona tavolo‚Ä¶",
    small_tisch_range: "Disponibile: tavolo 1 a 33",
    section_product: "Scegli il prodotto",
    tab_portions: "Porzioni",
    tab_kids: "Bambini",
    tab_eis: "Coppe & Spaghetti",
    tab_food: "Snack & Waffel",
    tab_drinks: "Bevande",
    label_product: "Prodotto:",
    label_flavors: "Gusti (opzionale, fino a 3):",
    small_flavors: "Se non scegli gusti, useremo la nostra miscela standard.",
    label_sahne: "Panna (+1,20 ‚Ç¨):",
    small_sahne: "Se non selezionato, prepariamo come nel menu.",
    label_bemerkung: "Osservazioni (opzionale):",
    placeholder_bemerkung: "es. senza panna, poca salsa ‚Ä¶",
    section_cart: "üß∫ Carrello",
    btn_add_cart: "Aggiungi al carrello",
    btn_whatsapp: "Invia ordine via WhatsApp üì≤",
    btn_print: "Stampa ordine üñ®Ô∏è",
    btn_reset_table: "Svuota tavolo / nuovi clienti",
    gps_info: "Controllo GPS‚Ä¶ consenti la posizione."
  },
  pt: {
    header_title: "Servi√ßo de Mesa QR ‚Äì Sistema interno",
    lang_label: "Idioma:",
    section_table: "Escolher mesa",
    label_tisch: "Selecionar n√∫mero da mesa:",
    option_tisch: "Selecionar mesa‚Ä¶",
    small_tisch_range: "Dispon√≠vel: mesa 1 at√© 33",
    section_product: "Escolher produto",
    tab_portions: "Por√ß√µes",
    tab_kids: "Crian√ßas",
    tab_eis: "Ta√ßas & Spaghetti",
    tab_food: "Snacks & Waffles",
    tab_drinks: "Bebidas",
    label_product: "Produto:",
    label_flavors: "Sabores (opcional, at√© 3):",
    small_flavors: "Se n√£o escolher sabores, usamos a nossa mistura standard.",
    label_sahne: "Natas (+1,20 ‚Ç¨):",
    small_sahne: "Se n√£o escolher, fazemos como est√° no menu.",
    label_bemerkung: "Observa√ß√µes (opcional):",
    placeholder_bemerkung: "ex.: sem natas, pouca calda ‚Ä¶",
    section_cart: "üß∫ Carrinho",
    btn_add_cart: "Adicionar ao carrinho",
    btn_whatsapp: "Enviar pedido por WhatsApp üì≤",
    btn_print: "Imprimir pedido üñ®Ô∏è",
    btn_reset_table: "Limpar mesa / novos clientes",
    gps_info: "A verificar GPS‚Ä¶ permita a localiza√ß√£o."
  },
  es: {
    header_title: "Servicio QR de mesa ‚Äì Sistema interno",
    lang_label: "Idioma:",
    section_table: "Elegir mesa",
    label_tisch: "Seleccionar n√∫mero de mesa:",
    option_tisch: "Seleccionar mesa‚Ä¶",
    small_tisch_range: "Disponible: mesa 1 hasta 33",
    section_product: "Elegir producto",
    tab_portions: "Porciones",
    tab_kids: "Ni√±os",
    tab_eis: "Copas & Spaghetti",
    tab_food: "Snacks & Gofres",
    tab_drinks: "Bebidas",
    label_product: "Producto:",
    label_flavors: "Sabores (opcional, hasta 3):",
    small_flavors: "Si no eliges sabores, usamos nuestra mezcla est√°ndar.",
    label_sahne: "Nata (+1,20 ‚Ç¨):",
    small_sahne: "Si no se elige, lo preparamos como en la carta.",
    label_bemerkung: "Observaciones (opcional):",
    placeholder_bemerkung: "ej.: sin nata, poca salsa‚Ä¶",
    section_cart: "üß∫ Carrito",
    btn_add_cart: "A√±adir al carrito",
    btn_whatsapp: "Enviar pedido por WhatsApp üì≤",
    btn_print: "Imprimir pedido üñ®Ô∏è",
    btn_reset_table: "Vaciar mesa / nuevos clientes",
    gps_info: "Comprobando GPS‚Ä¶ permita la ubicaci√≥n."
  },
  fr: {
    header_title: "Service de table QR ‚Äì Syst√®me interne",
    lang_label: "Langue :",
    section_table: "Choisir une table",
    label_tisch: "S√©lectionner le num√©ro de table :",
    option_tisch: "Choisir une table‚Ä¶",
    small_tisch_range: "Disponible : table 1 √† 33",
    section_product: "Choisir un produit",
    tab_portions: "Portions",
    tab_kids: "Enfants",
    tab_eis: "Coupes & Spaghetti",
    tab_food: "Snacks & Gaufres",
    tab_drinks: "Boissons",
    label_product: "Produit :",
    label_flavors: "Parfums (optionnel, jusqu‚Äô√† 3) :",
    small_flavors: "Sans choix de parfums, nous utilisons notre m√©lange standard.",
    label_sahne: "Chantilly (+1,20 ‚Ç¨) :",
    small_sahne: "Sans choix, nous pr√©parons comme sur la carte.",
    label_bemerkung: "Remarque (optionnel) :",
    placeholder_bemerkung: "ex. : sans chantilly, peu de sauce‚Ä¶",
    section_cart: "üß∫ Panier",
    btn_add_cart: "Ajouter au panier",
    btn_whatsapp: "Envoyer la commande WhatsApp üì≤",
    btn_print: "Imprimer la commande üñ®Ô∏è",
    btn_reset_table: "R√©initialiser la table / nouveaux clients",
    gps_info: "V√©rification GPS‚Ä¶ autorisez la localisation."
  },
  nl: {
    header_title: "QR-tafelservice ‚Äì Intern systeem",
    lang_label: "Taal:",
    section_table: "Tafel kiezen",
    label_tisch: "Tafelnummer kiezen:",
    option_tisch: "Tafel kiezen‚Ä¶",
    small_tisch_range: "Beschikbaar: tafel 1 t/m 33",
    section_product: "Product kiezen",
    tab_portions: "Porties",
    tab_kids: "Kinderen",
    tab_eis: "Coupes & Spaghetti",
    tab_food: "Snacks & Wafels",
    tab_drinks: "Drankjes",
    label_product: "Product:",
    label_flavors: "Smaken (optioneel, max. 3):",
    small_flavors: "Zonder keuze gebruiken we onze standaardmix.",
    label_sahne: "Slagroom (+1,20 ‚Ç¨):",
    small_sahne: "Zonder keuze bereiden we het zoals op het menu.",
    label_bemerkung: "Opmerkingen (optioneel):",
    placeholder_bemerkung: "bv. zonder slagroom, weinig saus‚Ä¶",
    section_cart: "üß∫ Winkelwagen",
    btn_add_cart: "Aan winkelwagen toevoegen",
    btn_whatsapp: "Bestelling via WhatsApp verzenden üì≤",
    btn_print: "Bestelling afdrukken üñ®Ô∏è",
    btn_reset_table: "Tafel wissen / nieuwe gasten",
    gps_info: "GPS controleren‚Ä¶ locatie toestaan."
  }
};

function applyLanguage(lang) {
  currentLang = lang;
  const t = translations[lang];

  const setText = (id, value) => {
    const el = document.getElementById(id);
    if (el && value != null) el.textContent = value;
  };

  setText("txt_header_title", t.header_title);
  setText("txt_lang_label", t.lang_label);
  setText("txt_section_table", t.section_table);
  setText("txt_label_tisch", t.label_tisch);
  const optT = document.getElementById("txt_option_tisch");
  if (optT && t.option_tisch) optT.textContent = t.option_tisch;
  setText("txt_small_tisch_range", t.small_tisch_range);

  setText("txt_section_product", t.section_product);
  setText("txt_tab_portions", t.tab_portions);
  setText("txt_tab_kids", t.tab_kids);
  setText("txt_tab_eis", t.tab_eis);
  setText("txt_tab_food", t.tab_food);
  setText("txt_tab_drinks", t.tab_drinks);

  setText("txt_label_product", t.label_product);
  setText("txt_label_flavors", t.label_flavors);
  setText("txt_small_flavors", t.small_flavors);
  setText("txt_label_sahne", t.label_sahne);
  setText("txt_small_sahne", t.small_sahne);
  setText("txt_label_bemerkung", t.label_bemerkung);
  const bem = document.getElementById("bemerkung");
  if (bem && t.placeholder_bemerkung) bem.placeholder = t.placeholder_bemerkung;

  setText("txt_section_cart", t.section_cart);
  setText("btn_add_to_cart", t.btn_add_cart);
  setText("txt_btn_whatsapp", t.btn_whatsapp);
  setText("txt_btn_print", t.btn_print);
  setText("txt_btn_reset_table", t.btn_reset_table);
  setText("gps-info", t.gps_info);
}

/* Ligar bot√µes das bandeiras */
document.querySelectorAll(".lang-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const lang = btn.dataset.lang;
    document.querySelectorAll(".lang-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    applyLanguage(lang);
  });
});

/* Chamar alem√£o ao iniciar */
applyLanguage("de");

/* ==== SAVE_ORDER.PHP + OVERRIDE WHATSAPP / PRINT ==== */

/* Esta fun√ß√£o usa as vari√°veis e fun√ß√µes do teu script original:
   - warenkorb
   - buildOrderText()
   - document.getElementById("tisch")
*/
function saveOrderToServer(channel) {
  if (typeof buildOrderText !== "function") return;
  const table = document.getElementById("tisch") ? (document.getElementById("tisch").value || "-") : "-";
  const data = {
    table,
    time: new Date().toISOString(),
    lang: currentLang,
    channel,
    text: buildOrderText()
  };

  fetch("save_order.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  }).catch(() => {
    // se falhar, n√£o vamos chatear o cliente
  });
}

/* Vamos substituir as tuas fun√ß√µes sendWhatsApp() e printOrder()
   mas a l√≥gica √© praticamente a mesma, s√≥ que tamb√©m chama save_order.php.
   IMPORTANTE: assumo que no teu script original existem:
   - gpsOk
   - WHATSAPP_NUMMER
   - warenkorb
   - buildOrderText()
   - updateCart()
   - storeOrder(channel)
*/

window.sendWhatsApp = function() {
  if (typeof gpsOk !== "undefined" && !gpsOk) {
    alert("Bestellung nur vor Ort m√∂glich. Bitte Standortfreigabe erlauben.");
    return;
  }
  if (!Array.isArray(warenkorb) || warenkorb.length === 0) {
    alert("Der Warenkorb ist leer.");
    return;
  }

  // guardar para Chef-Bereich (fun√ß√£o do teu script)
  if (typeof storeOrder === "function") {
    storeOrder("WhatsApp");
  }

  // guardar tamb√©m em save_order.php
  saveOrderToServer("WhatsApp");

  const text = encodeURIComponent(buildOrderText());
  const url = `https://wa.me/${typeof WHATSAPP_NUMMER !== "undefined" ? WHATSAPP_NUMMER : ""}?text=${text}`;
  window.open(url, "_blank");

  // limpar carrinho
  warenkorb = [];
  if (typeof updateCart === "function") updateCart();
};

window.printOrder = function() {
  if (!Array.isArray(warenkorb) || warenkorb.length === 0) {
    alert("Der Warenkorb ist leer.");
    return;
  }

  // guardar para Chef-Bereich
  if (typeof storeOrder === "function") {
    storeOrder("Drucker");
  }

  // guardar tamb√©m em save_order.php
  saveOrderToServer("Drucker");

  const tisch = document.getElementById("tisch") ? (document.getElementById("tisch").value || "-") : "-";
  const htmlText = buildOrderText().replace(/\n/g, "<br>");

  const win = window.open("", "_blank");
  win.document.open();
  win.document.write(`
    <html>
    <head><meta charset="UTF-8"><title>Bestellung Tisch ${tisch}</title></head>
    <body style="font-family:Arial,sans-serif; font-size:14px;">
      <h2>Bestellung Tisch ${tisch}</h2>
      <p>${htmlText}</p>
    </body>
    </html>
  `);
  win.document.close();
  win.print();
};
</script>

</body>
</html>
